require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var uuid=require("uuid"),wrapper=require("../util/callbackWrapper.js"),shared=require("./shared.js");function Connection(ws,codec,direction,key,requestMap,id,logger){shared(this,id,direction,ws);this.send=function(message,options,callback){logger.silly("sending message",message);var dfd=wrapper(callback||options);options=callback?options:{};var dir=(direction.get(message)||"MESSAGE").toUpperCase();var k=key.get(message);if(!k&&dir==="REQUEST"){k=uuid.v4();key.set(message,k)}var wireMessage=codec.encode(message);ws.send(wireMessage,options);if(dir==="REQUEST"){logger.silly("storing request");requestMap[k]=dfd}else{logger.verbose("resolving send");dfd.resolve()}return dfd.promise()}}exports=module.exports=Connection},{"../util/callbackWrapper.js":7,"./shared.js":2,uuid:12}],2:[function(require,module,exports){var wrapper=require("../util/callbackWrapper.js");exports=module.exports=function(self,id,direction,ws){self.id=id;self.request=function(message,options,callback){direction.set(message,"REQUEST");return this.send(message,options,callback)};self.close=function(code,reason,callback){dfd=wrapper(callback);try{ws.close(code,reason)}catch(err){dfd.reject(err)}dfd.resolve();return dfd.promise()}}},{"../util/callbackWrapper.js":7}],3:[function(require,module,exports){var uuid=require("uuid"),MessageContext=require("./messageContext");exports=module.exports=function(ws,logger,useMap,events,Connection,closed){var self=this;useMap.key=useMap.key||defaultKey;useMap.direction=useMap.direction||defaultDirection;useMap.codec=useMap.codec||defaultCodec;useMap.type=useMap.type||defaultType;var requestMap={};this.id=uuid.v4();this.ws=ws;this.connection=new Connection(ws,useMap.codec,useMap.direction,useMap.key,requestMap,this.id,logger);ws.addEventListener("message",function(data){try{logger.debug("got message from socket",data.data,data.type);var string;if(data.type==="Text"){string=data.data}else{string=data.data.toString("utf8")}var obj=useMap.codec.decode(string);var direction=(useMap.direction.get(obj)||"MESSAGE").toUpperCase();var type=useMap.type.get(obj);var key=useMap.key.get(obj);if(direction==="REPLY"||direction==="ERROR"||direction==="PARTIAL"){var dfd=requestMap[key];if(!dfd){logger.warn("unknow reply was recieved",obj)}else if(direction==="REPLY"){dfd.resolve(obj);delete requestMap[key]}else if(direction==="PARTIAL"){dfd.notify(obj)}else{dfd.reject(obj);delete requestMap[key]}}else{event=getEvent(direction,type);event(new MessageContext(obj,type,self.connection,useMap.direction.set,useMap.key.set,direction,key))}}catch(err){events["error"](err)}});function getEvent(direction,type){var rtn;if(type){rtn=events[direction.toLowerCase()+"/"+type]}return rtn||events[direction.toLowerCase()]}ws.addEventListener("close",function(data){if(closed){closed(self)}logger.verbose("calling close callback",self.connection.id);events["close"](data.code,data.reason,self.connection)});ws.addEventListener("error",function(err){events["error"](err)});ws.addEventListener("ping",function(err){events["ping"](err)});ws.addEventListener("pong",function(err){events["pong"](err)})};var defaultKey={get:function(message){return message.key},set:function(message,key){message.key=key}};var defaultDirection={get:function(message){return message.direction},set:function(message,direction){message.direction=direction}};var defaultCodec={encode:function(message){return JSON.stringify(message)},decode:function(string){return JSON.parse(string)}};var defaultType={get:function(message){return message.type}}},{"./messageContext":4,uuid:12}],4:[function(require,module,exports){exports=module.exports=function(message,type,connection,setDirection,setKey,direction,key){this.message=message;this.type=type;this.connection=connection;if(direction==="REQUEST"){this.reply=function(messageObject,options,callback){return send(messageObject,options,callback,"REPLY")};this.error=function(messageObject,options,callback){return send(messageObject,options,callback,"ERROR")};this.partial=function(messageObject,options,callback){return send(messageObject,options,callback,"PARTIAL")};function send(messageObject,options,callback,dir){setKey(messageObject,key);setDirection(messageObject,dir);return connection.send(messageObject,options,callback)}}}},{}],5:[function(require,module,exports){var wrapper=require("../util/callbackWrapper.js"),WebSocket=require("ws"),Logger=require("../util/logger.js"),Context=require("../context/context.js"),shared=require("./shared.js");exports=module.exports=function(options,Connection){var logger=new Logger(options?options.logLevel||3:3);var useMap={};var events={};var ws;var context;shared(this,useMap,events,logger);this.connect=function(url,protocols,callback){if(arguments.length===2){callback=protocols;protocols=[]}var dfd=wrapper(callback);ws=new WebSocket(url,protocols);context=new Context(ws,logger,useMap,events,Connection);ws.addEventListener("open",function(){logger.verbose("resolving with connection",context.connection);dfd.resolve(context.connection)});ws.addEventListener("error",function(err){if(dfd.state()===0){logger.verbose("rejecting connection because of error",err);dfd.reject(err)}});return dfd.promise()}}},{"../context/context.js":3,"../util/callbackWrapper.js":7,"../util/logger.js":8,"./shared.js":6,ws:13}],6:[function(require,module,exports){exports=module.exports=function(self,useMap,events,logger){self.on=function(event,type,callback){event=event.toLowerCase();if(!callback){if(typeof type!=="function"){throw new Error("argument callback must be a function")}events[event]=type}else{if(typeof callback!=="function"){throw new Error("argument callback must be a function")}events[event+"/"+type]=callback}logger.verbose("added new event",events.id,event,events[event])};self.use=function(type,getter,setter){useMap[type]={};if(type==="codec"){useMap[type].decode=getter;useMap[type].encode=setter}else{useMap[type].get=getter;useMap[type].set=setter}};events["connection"]=function(connection){logger.info("connection established",connection)};events["message"]=function(context){logger.info("recieved message",context.message)};events["request"]=function(context){logger.info("recieved request",context.message)};events["close"]=function(code,reason,connection){logger.info("connection closed",code,reason,connection)};events["error"]=function(err){logger.info("error",err)}}},{}],7:[function(require,module,exports){var p=require("jpromise");exports=module.exports=function(callback){if(typeof callback==="function"){var rtn=new p;rtn.done(function(value){callback(null,value)}).fail(function(err){callback(err)}).progress(function(value){callback(null,null,value)});return rtn}else{return callback||new p}}},{jpromise:10}],8:[function(require,module,exports){exports=module.exports=function(level){this.level=levelToNum(level);this.log=function(){console.log.apply(this,arguments)};this.error=function(){if(this.level>=1){console.log.apply(console,arguments)}};this.warn=function(){if(this.level>=2){console.log.apply(console,arguments)}};this.info=function(){if(this.level>=3){console.log.apply(console,arguments)}};this.verbose=function(){if(this.level>=4){console.log.apply(console,arguments)}};this.debug=function(){if(this.level>=5){console.log.apply(console,arguments)}};this.silly=function(){if(this.level>=6){console.log.apply(console,arguments)}};return this};function levelToNum(level){if(typeof level==="number"){return level}switch(level){case"error":return 1;case"warn":return 2;case"info":return 3;case"verbose":return 4;case"debug":return 5;case"silly":return 6;default:return 3}}},{}],9:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;function drainQueue(){if(draining){return}draining=true;var currentQueue;var len=queue.length;while(len){currentQueue=queue;queue=[];var i=-1;while(++i<len){currentQueue[i]()}len=queue.length}draining=false}process.nextTick=function(fun){queue.push(fun);if(!draining){setTimeout(drainQueue,0)}};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],10:[function(require,module,exports){(function(process){(function(root){"use strict";(function(factory){if(typeof define==="function"&&define.amd){define(factory)}else if(typeof exports==="object"){if(Object.keys(module.exports).length!==0){module.exports.p=module.exports.Dfd=factory()}else{module.exports=factory()}}else{root.p=factory();if(typeof root._!=="undefined"){root._.Dfd=root.p}}})(function(){function extend(a,b){for(var key in b){a[key]=b[key]}}function isFunction(a){return!!(a&&Object.prototype.toString.call(a)==="[object Function]")}function isObject(a){return!!(a&&Object.prototype.toString.call(a)==="[object Object]")}function isArray(a){return!!(a&&Object.prototype.toString.call(a)==="[object Array]")}function isPromise(promise){if(typeof promise!=="undefined"&&promise!==null&&promise.toString&&promise.toString()==="[object Promise]"){return true}return false}function isDeferred(deferred){if(typeof deferred!=="undefined"&&deferred!==null&&deferred.toString&&deferred.toString()==="[object Deferred]"){return true}return false}var setTimeout=root.setTimeout;if(typeof process==="object"&&isFunction(process.nextTick)){setTimeout=process.nextTick}function callback(scope,data,cbs){setTimeout(function dfdTimeout(){for(var i=0;i<cbs.length;i++){cbs[i].call(scope,data)}},0)}function sanitizeCbs(cbs){if(cbs&&!isArray(cbs)){cbs=[cbs]}return cbs}var internalFilteredDataInstance={mine:"mine"};var filteredData=internalFilteredDataInstance;function getThenFilterCallback(filter,newp,what){return function(data){filteredData=internalFilteredDataInstance;if(filter&&isFunction(filter)){try{filteredData=filter.call(undefined,data)}catch(e){filteredData=internalFilteredDataInstance;newp.reject(e)}if(filteredData!==internalFilteredDataInstance){if(what==="reject"){newp.resolve(filteredData)}else{newp[what](filteredData)}}}else{newp[what](data)}}}function doIsPromiseSteal(data,scope){data.done(function(resData){scope.doResolve(resData)});data.fail(function(rejData){scope.doReject(rejData)});data.progress(function(progData){scope.doNotify(progData)})}function doWhatYouShould(data,what,scope){switch(what){case"resolve":scope.doResolve(data);break;case"reject":scope.doReject(data);break;case"notify":scope.doNotify(data);break}}function doTryAndGetDatasThen(data,scope){var ret={failed:false,datasThen:undefined};try{ret.datasThen=data.then}catch(e){ret.datasThen=undefined;ret.failed=true;scope.doReject(e)}return ret}function doDatasThenIsAFunction(datasThen,data,scope){var fCalled=false;try{var datasThenp=new p;datasThenp.done(function(resData){scope.doResolve(resData)}).fail(function(rejData){scope.doReject(rejData)}).progress(function(progData){scope.doProgress(progData)});datasThen.call(data,function(resData){if(!fCalled){fCalled=true;datasThenp.resolve(resData)}},function(rejData){if(!fCalled){fCalled=true;datasThenp.reject(rejData)}},function(progData){datasThenp.notify(progData)})}catch(e){if(!fCalled){scope.doReject(e)}}}function doStealDatasThen(data,what,scope){var ret=doTryAndGetDatasThen(data,scope);if(!ret.failed){if(isFunction(ret.datasThen)){doDatasThenIsAFunction(ret.datasThen,data,scope)}else{doWhatYouShould(data,what,scope)}}}var p=function p(beforeStart){if(this.constructor!==p){throw new Error("You must create deferreds with the 'new' keyword")}this.internalState=0;this.internalWith=undefined;this.internalData=null;this.callbacks={done:[],fail:[],always:[],progress:[]};this._pro=null;if(beforeStart&&isFunction(beforeStart)){beforeStart.call(this,this)}return this};var Promise=function(p,target){this.done=p.done.bind(p);this.fail=p.fail.bind(p);this.progress=p.progress.bind(p);this.always=p.always.bind(p);this.then=p.then.bind(p);this.finish=p.finish.bind(p);this.state=function(){return p.internalState};if(target&&isObject(target)){extend(target,this);return target}return this};extend(Promise.prototype,{toString:function(){return"[object Promise]"}});extend(p.prototype,{toString:function(){return"[object Deferred]"},Promise:Promise,notify:function(data){if(this.internalState===0){this.internalData=data;callback(this.internalWith,this.internalData,this.callbacks.progress)}return this},notifyWith:function(scope,data){if(this.internalState===0){this.internalWith=scope;this.internalData=data;callback(this.internalWith,this.internalData,this.callbacks.progress)}return this},doNotify:function(data){this.internalData=data;callback(this.internalWith,this.internalData,this.callbacks.progress)},reject:function(data){if(this.internalState===0){this.deNestSanitizeTheInsanityAndCall(data,"reject")}return this},rejectWith:function(scope,data){if(this.internalState===0){this.internalWith=scope;this.deNestSanitizeTheInsanityAndCall(data,"reject")}return this},doReject:function(data){this.internalData=data;this.internalState=2;callback(this.internalWith,this.internalData,this.callbacks.fail.concat(this.callbacks.always))},resolve:function(data){if(this.internalState===0){this.deNestSanitizeTheInsanityAndCall(data,"resolve")}return this},resolveWith:function(scope,data){if(this.internalState===0){this.internalWith=scope;this.deNestSanitizeTheInsanityAndCall(data,"resolve")}return this},doResolve:function(data){this.internalData=data;this.internalState=1;callback(this.internalWith,this.internalData,this.callbacks.done.concat(this.callbacks.always))},always:function(cbs){cbs=sanitizeCbs(cbs);if(cbs.length>0){if(this.internalState!==0){callback(this.internalWith,this.internalData,cbs)}else{this.callbacks.always=this.callbacks.always.concat(cbs)}}return this.promise()},done:function(cbs){cbs=sanitizeCbs(cbs);if(cbs.length>0){if(this.internalState===1){callback(this.internalWith,this.internalData,cbs)}else{this.callbacks.done=this.callbacks.done.concat(cbs)}}return this.promise()},fail:function(cbs){cbs=sanitizeCbs(cbs);if(cbs.length>0){if(this.internalState===2){callback(this.internalWith,this.internalData,cbs)}else{this.callbacks.fail=this.callbacks.fail.concat(cbs)}}return this.promise()},progress:function(cbs){if(this.internalState===0){cbs=sanitizeCbs(cbs);this.callbacks.progress=this.callbacks.progress.concat(cbs)}return this.promise()},deNestSanitizeTheInsanityAndCall:function(data,what){if(data===this.promise()){this.doReject(new TypeError("Promise Tried to Resolve with Self"))}else if(isPromise(data)){doIsPromiseSteal(data,this)}else if(isObject(data)||isFunction(data)){doStealDatasThen(data,what,this)}else{doWhatYouShould(data,what,this)}},then:function(doneFilter,failFilter,progressFilter){var newp=new p;this.done(getThenFilterCallback(doneFilter,newp,"resolve")).fail(getThenFilterCallback(failFilter,newp,"reject")).progress(getThenFilterCallback(progressFilter,newp,"notify"));return newp.promise()},finish:function(){this.callbacks.fail.concat(this.callbacks.always);this.callbacks.fail.push(function(e){setTimeout(function(){throw e},0)})},wrap:function(thennable){var newp=new p;var datasThen;if(isPromise(thennable)||isDeferred(thennable)){doIsPromiseSteal(thennable,newp)}else if(isObject(thennable)||isFunction(thennable)){doStealDatasThen(thennable,"resolve",newp)}else{newp.resolve(thennable)}return newp.promise()},when:function(){var args=Array.prototype.slice.call(arguments);var promises=[];var newp=new p;var resolvedCount=0;var handledCount=0;var whenData=[];args.forEach(function(item){if(isArray(item)){promises=promises.concat(item)}else{promises.push(item)}});if(promises.length===0){newp.resolve(whenData)}promises.forEach(function(promise,i){if(isPromise(promise)||isDeferred(promise)||!!promise){if(!isPromise(promise)&&!isDeferred(promise)){promise=p.wrap(promise)}promise.done(function(data){resolvedCount++;handledCount++;whenData[i]=data;newp.notify({index:i,action:"resolved",data:data,resolved:resolvedCount,handled:handledCount});if(resolvedCount===promises.length){newp.resolve(whenData)}else if(handledCount===promises.length){newp.reject(whenData)}}).fail(function(data){handledCount++;whenData[i]=data;newp.notify({index:i,action:"rejected",data:data,resolved:resolvedCount,handled:handledCount});if(resolvedCount===promises.length){newp.resolve(whenData)}else if(handledCount===promises.length){newp.reject(whenData)}}).progress(function(data){newp.notify(data)})}else{handledCount++;whenData[i]=promise}});if(resolvedCount===promises.length){newp.resolve(whenData)}else if(handledCount===promises.length){newp.reject(whenData)}return newp.promise()},promise:function(target){if(!this._pro){this._pro=new this.Promise(this,target)}return this._pro},state:function(){return this.internalState}});p.when=p.prototype.when;p.wrap=p.prototype.wrap;if(Object.freeze){Object.freeze(p.prototype)}return p})})(this)}).call(this,require("_process"))},{_process:9}],11:[function(require,module,exports){(function(global){var rng;if(global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);rng=function whatwgRNG(){crypto.getRandomValues(_rnds8);return _rnds8}}if(!rng){var _rnds=new Array(16);rng=function(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;_rnds[i]=r>>>((i&3)<<3)&255}return _rnds}}module.exports=rng}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],12:[function(require,module,exports){var _rng=require("./rng");var _byteToHex=[];var _hexToByte={};for(var i=0;i<256;i++){_byteToHex[i]=(i+256).toString(16).substr(1);_hexToByte[_byteToHex[i]]=i}function parse(s,buf,offset){var i=buf&&offset||0,ii=0;buf=buf||[];s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){if(ii<16){buf[i+ii++]=_hexToByte[oct]}});while(ii<16){buf[i+ii++]=0}return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}var _seedBytes=_rng();var _nodeId=[_seedBytes[0]|1,_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]];var _clockseq=(_seedBytes[6]<<8|_seedBytes[7])&16383;var _lastMSecs=0,_lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0;var b=buf||[];options=options||{};var clockseq=options.clockseq!==undefined?options.clockseq:_clockseq;var msecs=options.msecs!==undefined?options.msecs:(new Date).getTime();var nsecs=options.nsecs!==undefined?options.nsecs:_lastNSecs+1;var dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&options.clockseq===undefined){clockseq=clockseq+1&16383}if((dt<0||msecs>_lastMSecs)&&options.nsecs===undefined){nsecs=0}if(nsecs>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}_lastMSecs=msecs;_lastNSecs=nsecs;_clockseq=clockseq;msecs+=122192928e5;var tl=((msecs&268435455)*1e4+nsecs)%4294967296;b[i++]=tl>>>24&255;b[i++]=tl>>>16&255;b[i++]=tl>>>8&255;b[i++]=tl&255;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255;b[i++]=tmh&255;b[i++]=tmh>>>24&15|16;b[i++]=tmh>>>16&255;b[i++]=clockseq>>>8|128;b[i++]=clockseq&255;var node=options.node||_nodeId;for(var n=0;n<6;n++){b[i+n]=node[n]}return buf?buf:unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options=="binary"?new Array(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||_rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;ii++){buf[i+ii]=rnds[ii]}}return buf||unparse(rnds)}var uuid=v4;uuid.v1=v1;uuid.v4=v4;uuid.parse=parse;uuid.unparse=unparse;module.exports=uuid},{"./rng":11}],13:[function(require,module,exports){var global=function(){return this}();var WebSocket=global.WebSocket||global.MozWebSocket;module.exports=WebSocket?ws:null;function ws(uri,protocols,opts){var instance;if(protocols){instance=new WebSocket(uri,protocols)}else{instance=new WebSocket(uri)}return instance}if(WebSocket)ws.prototype=WebSocket.prototype},{}],wyre:[function(require,module,exports){var Client=require("./transports/client.js"),Connection=require("./connections/browserConnection.js");exports=module.exports=function(options){return new Client(options,Connection)}},{"./connections/browserConnection.js":1,"./transports/client.js":5}]},{},[]);